{"version":3,"sources":["../src/Cursor.js"],"names":[],"mappings":";;;;;;;;;;;AAAA,IAAI,cAAc,GAAG,OAAO,CAAC,mCAAmC,CAAC,CAAC,cAAc,CAAC;AACjF,IAAI,SAAS,GAAG,OAAO,CAAC,+BAA+B,CAAC,CAAC;;IAE5C,MAAM,WAAN,MAAM;AACJ,aADF,MAAM,CACH,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE;8BAD3B,MAAM;;AAEX,YAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC1B,YAAI,CAAC,MAAM,GAAG,KAAK,CAAC;AACpB,YAAI,CAAC,MAAM,GAAG,KAAK,CAAC;KACvB;;cALQ,MAAM;;iBAAN,MAAM;AAOX,aAAK;iBAAA,YAAG;AACR,uBAAO,IAAI,CAAC,MAAM,CAAC;aACtB;;AAED,eAAO;mBAAA,iBAAC,KAAK,EAAE;AACX,yBAAS,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC;AAChE,uBAAO,IAAI,CAAC;aACf;;AAED,YAAI;mBAAA,gBAAG;;;AACH,uBAAO,SAAS,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,UAAC,MAAM,EAAK;AAC1E,0BAAK,OAAO,GAAG,MAAM,CAAC;AACtB,0BAAK,UAAU,GAAG,MAAK,GAAG,GAAG,MAAM,IAAI,MAAM,CAAC,MAAK,MAAM,CAAC,OAAO,CAAC,CAAC;AACnE,2BAAO,MAAK,GAAG,CAAC;iBACnB,CAAC,CAAC;aACN;;AAED,cAAM;mBAAA,kBAAG;AACL,uBAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aACxC;;AAED,cAAM;mBAAA,kBAAG;AACL,uBAAO,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aAC5C;;AAED,mBAAW;mBAAA,qBAAC,QAAQ,EAAE;;;AAClB,oBAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;AAChC,yBAAS,CAAC,EAAE,CAAC,oBAAoB,GAAG,IAAI,CAAC,SAAS,EAAE,UAAC,MAAM,EAAK;AAC5D,wBAAI,CAAC,MAAM,EAAE;AACT,+BAAO,OAAO,CAAC,IAAI,CAAC;mCAAM,MAAK,KAAK,EAAE;yBAAA,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;qBACzD;AACD,2BAAO,CAAC,IAAI,CAAC,YAAM;AACf,8BAAK,OAAO,GAAG,MAAM,CAAC;AACtB,8BAAK,UAAU,GAAG,MAAK,GAAG,GAAG,MAAM,IAAI,MAAM,CAAC,MAAK,MAAM,CAAC,OAAO,CAAC,CAAC;AACnE,+BAAO,QAAQ,CAAC,MAAK,GAAG,CAAC,CAAC;qBAC7B,CAAC,CAAC;iBACN,CAAC,CAAC;AACH,uBAAO,SAAS,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,IAAI,CAAC,YAAM;AACvE,6BAAS,CAAC,GAAG,CAAC,oBAAoB,GAAG,MAAK,SAAS,CAAC,CAAC;AACrD,2BAAO,OAAO,CAAC;iBAClB,CAAC,CAAC;aACN;;AAED,aAAK;mBAAA,iBAAG;;;AACJ,uBAAO,SAAS,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,YAAM;AACrE,0BAAK,OAAO,GAAG,MAAK,MAAM,GAAG,MAAK,SAAS,GAAG,SAAS,CAAC;iBAC3D,CAAC,CAAC;aACN;;;;WAtDQ,MAAM;GAAS,cAAc","file":"src/Cursor.js","sourcesContent":["var AbstractCursor = require('springbokjs-db/lib/AbstractCursor').AbstractCursor;\nvar webSocket = require('springbokjs-browser/webSocket');\n\nexport class Cursor extends AbstractCursor {\n    constructor(idCursor, store, query) {\n        this._idCursor = idCursor;\n        this._store = store;\n        this._query = query;\n    }\n\n    get query() {\n        return this._query;\n    }\n\n    advance(count) {\n        webSocket.emit('db cursor ' + this._idCursor, 'advance', count);\n        return this;\n    }\n\n    next() {\n        return webSocket.emit('db cursor ' + this._idCursor, 'next').then((result) => {\n            this._result = result;\n            this.primaryKey = this.key = result && result[this._store.keyPath];\n            return this.key;\n        });\n    }\n\n    result() {\n        return Promise.resolve(this._result);\n    }\n\n    remove() {\n        return this._store.deleteByKey(this.key);\n    }\n\n    forEachKeys(callback) {\n        var promise = Promise.resolve();\n        webSocket.on('db cursor forEach ' + this._idCursor, (result) => {\n            if (!result) {\n                return promise.then(() => this.close()).then(resolve);\n            }\n            promise.then(() => {\n                this._result = result;\n                this.primaryKey = this.key = result && result[this._store.keyPath];\n                return callback(this.key);\n            });\n        });\n        return webSocket.emit('db cursor ' + this._idCursor, 'forEach').then(() => {\n            webSocket.off('db cursor forEach ' + this._idCursor);\n            return promise;\n        });\n    }\n\n    close() {\n        return webSocket.emit('db cursor ' + this._idCursor, 'close').then(() => {\n            this._result = this._store = this._idCursor = undefined;\n        });\n    }\n}\n"]}