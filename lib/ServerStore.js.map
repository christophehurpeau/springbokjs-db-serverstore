{"version":3,"sources":["../src/ServerStore.js"],"names":[],"mappings":"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","file":"src/ServerStore.js","sourcesContent":["var AbstractStore = require('springbokjs-db/lib/AbstractStore').AbstractStore;\nvar webSocket = require('springbokjs-browser/webSocket');\nvar Cursor = require('./Cursor').Cursor;\n\nexport class ServerStore extends AbstractStore {\n    initialize() {\n    }\n\n    store() {\n    }\n\n    findOne(query, options) {\n        var modelName = this.manager.VO.name[0].toLowerCase() + this.manager.VO.name.substr(1)\n        return webSocket.emit('db findOne', this.db.dbName, modelName, query, options);\n    }\n\n    insert(options) {\n        var modelName = this.manager.VO.name[0].toLowerCase() + this.manager.VO.name.substr(1)\n        return webSocket.emit('db insert', this.db.dbName, modelName, options).then((result) => {\n            if (result) {\n                Object.assign(options.fullData, result);\n            }\n        });\n    }\n\n    update(options) {\n        throw new Error();\n    }\n\n    delete(options) {\n        throw new Error();\n    }\n\n    cursor(query, options) {\n        var modelName = this.manager.VO.name[0].toLowerCase() + this.manager.VO.name.substr(1)\n        return webSocket.emit('db cursor', this.db.dbName, modelName, query, options).then((idCursor) => {\n            if (!idCursor) {\n                return;\n            }\n            return new Cursor(idCursor, this, query);\n        });\n    }\n\n    subscribe(listeners) {\n        var modelName = this.manager.VO.name[0].toLowerCase() + this.manager.VO.name.substr(1)\n        return webSocket.emit('subscribe', this.db.dbName, modelName, listeners.query).then((listenerId) => {\n            listeners.listenerId = listenerId;\n            console.log('listing for: ' + listenerId + ' event')\n            webSocket.on(listenerId + ' event', (result) => {\n                var { type, data } = result;\n                console.log('received event', type, data);\n                if (listeners[type]) {\n                    listeners[type](this.toVO(data));\n                }\n            });\n        });\n    }\n\n    unsubscribe(listeners) {\n        webSocket.off(listeners.listenerId + ' event');\n        return webSocket.emit('unsubscribe ' + listeners.listenerId);\n    }\n}\n\nServerStore.initialize = function(db) {\n    return Promise.resolve();\n};\n"]}